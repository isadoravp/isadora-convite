<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meus 15</title>

<style>
:root{
  --azul:#1f3f73;
  --roxo:#4a3b6e;
  --vermelho:#7a2c2c;
  --dourado:#f2c94c;
}

/* ====== BASE ====== */
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:'Georgia',serif;
}

body{
  background:linear-gradient(45deg,var(--azul),var(--roxo),var(--vermelho),#c98b2b);
  position:relative;
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.06), transparent 42%),
    radial-gradient(circle at 80% 70%, rgba(255,255,255,0.05), transparent 48%);
  pointer-events:none;
  z-index:-1;
}

/* ====== CEN√ÅRIO CASTELO ====== */
.cenario-castelo{
  position:fixed;
  left:50%;
  bottom:16%;
  transform:translateX(-50%);
  width:125%;
  max-width:1400px;
  height:90vh;
  background:url("assets/castelo1.png") center bottom no-repeat;
  background-size:100% auto;
  z-index:0;
  pointer-events:none;
  opacity:0.95;
  filter:brightness(1.12) contrast(1.08) saturate(1.05);
  mask-image:linear-gradient(to top, transparent 0%, rgba(0,0,0,0.25) 12%, rgba(0,0,0,0.6) 28%, rgba(0,0,0,0.9) 45%, black 65%);
  -webkit-mask-image:linear-gradient(to top, transparent 0%, rgba(0,0,0,0.25) 12%, rgba(0,0,0,0.6) 28%, rgba(0,0,0,0.9) 45%, black 65%);
}

.cenario-castelo::after{
  content:"";
  position:absolute;
  left:0;
  right:0;
  bottom:-60px;
  height:260px;
  background:linear-gradient(to top, rgba(31,63,115,0.65), rgba(31,63,115,0.35), rgba(31,63,115,0.15), transparent);
  filter:blur(48px);
}

/* ====== PART√çCULAS ====== */
#particles{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1;
}

.spark{
  position:absolute;
  top:-10px;
  width:2px;
  height:2px;
  background:var(--dourado);
  box-shadow:0 0 4px #ffd700;
  border-radius:50%;
  animation:fall linear forwards;
}

@keyframes fall{
  to{
    transform:translateY(110vh);
    opacity:0;
  }
}

/* ====== CARTA ====== */
.carta-container{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:300px;
  max-width:78vw;
  cursor:pointer;
  z-index:3;
  filter:drop-shadow(0 18px 40px rgba(0,0,0,0.55)) drop-shadow(0 0 22px rgba(180,220,255,0.35));
}

.carta-container img{
  width:100%;
  position:absolute;
  top:0;
  left:0;
  transition:opacity 1.4s ease, transform 1.6s ease;
}

.carta-fechada{
  opacity:1;
  pointer-events:all;
}

.carta-aberta{
  opacity:0;
  transform:scale(0.95);
  pointer-events:none;
}

.carta-container.aberta .carta-fechada{
  animation:pulseGlow 1.6s ease-in-out forwards;
  opacity:0;
  transform:scale(0.9);
}

.carta-container.aberta .carta-aberta{
  animation:pulseGlow 1.6s ease-in-out forwards;
  opacity:1;
  transform:scale(1);
}

@keyframes pulseGlow{
  40%{
    filter:drop-shadow(0 0 28px rgba(180,220,255,0.8));
  }
}

/* ====== FUMA√áA ====== */
.fumaca-container{
  position:absolute;
  inset:0;
  pointer-events:none;
}

.smoke{
  position:absolute;
  bottom:13%;
  left:50%;
  border-radius:50%;
  animation:smokeUp 3.2s ease-out forwards;
  background:radial-gradient(circle, rgba(255,220,140,0.75) 0%, rgba(240,190,95,0.55) 35%, rgba(210,160,60,0.32) 60%, rgba(170,120,35,0.12) 100%);
  filter:blur(26px);
}

@keyframes smokeUp{
  to{
    transform:translate(calc(-50% + var(--x)),-90px) scale(1.1);
    opacity:0;
  }
}

/* ====== GLITTER ====== */
.magic-glitter{
  position:absolute;
  width:6px;
  height:6px;
  bottom:15%;
  left:50%;
  border-radius:50%;
  background:radial-gradient(circle,#fff6c7 0%,#ffd700 45%,transparent 100%);
  filter:blur(12px);
  animation:glitterUp 2.2s ease-out forwards;
}

@keyframes glitterUp{
  to{
    transform:translate(calc(-50% + var(--gx)),-140px) scale(1.3);
    opacity:0;
  }
}

/* ====== CONVITE ====== */
#convite{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  max-width:88%;
  max-height:88%;
  object-fit:contain;
  z-index:2;
  opacity:0;
  transition:opacity 1.2s ease;
  cursor:pointer;
}

/* ====== ESTRELAS ====== */
.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: radial-gradient(circle, #ffd700, rgba(255,255,255,0));
  border-radius: 50%;
  pointer-events: none;
  opacity: 0.8;
  animation: moveStar linear infinite;
}

@keyframes moveStar {
  from { transform: translateY(100vh) scale(1); opacity:0; }
  10% { opacity:1; }
  to { transform: translateY(-120vh) scale(0.6); opacity:0; }
}

/* ====== BOT√ïES / MODAIS ====== */
.btn-modal {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #f17ea1;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 14px 20px;
  font-size: 15px;
  cursor: pointer;
  z-index:5;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.modal, .sub-modal {
  display: none;
  position: fixed;
  inset:0;
  background: rgba(0,0,0,0.6);
  z-index:10;
  align-items:center;
  justify-content:center;
}

.modal-content, .sub-modal-content {
  border-radius:14px;
  padding:22px;
  width:90%;
  max-width:420px;
  max-height:90vh;
  overflow-y:auto;
  position: relative;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.modal-content{ background:#00498e; color:#fff; }
.close{ position:absolute; right:14px; top:10px; font-size:26px; cursor:pointer; }
.modal-button{
  padding:14px; border:none; border-radius:10px; background:#f17ea1; color:#00498e;
  font-size:16px; text-align:left; cursor:pointer;
}
.modal-button:hover{ background:#ffd700; color:#000; }

.sub-modal-content{
  background: linear-gradient(160deg, #f2c94c, #e6b93d, #cfa432);
  color:#2b2b2b;
  box-shadow:0 0 25px rgba(242,201,76,0.45),0 0 60px rgba(242,201,76,0.25);
}
.sub-modal-content h3{ color:#4a3b00; }
.sub-modal-content li{ color:#3b2a00; }

#audioOverlay{
  position: fixed;
  inset: 0;
  z-index: 9999;
}
</style>
</head>

<body>
<div class="cenario-castelo"></div>
<div id="particles"></div>

<div class="carta-container" id="carta">
  <img src="assets/carta-fechada.png" class="carta-fechada">
  <img src="assets/carta-aberta.png" class="carta-aberta">
  <div class="fumaca-container" id="fumaca"></div>
</div>

<img src="assets/convite.png" id="convite">

<div id="audioOverlay"></div>

<button class="btn-modal">Informa√ß√µes</button>

<div class="modal" id="modalPrincipal">
  <div class="modal-content">
    <span class="close" data-close="modalPrincipal">&times;</span>
    <button class="modal-button" id="dressCode">üëó Dress Code</button>
    <button class="modal-button" id="verRota">üìç Ver Rota</button>
    <button class="modal-button" id="confirmePresenca">‚úÖ Confirmar Presen√ßa</button>
    <button class="modal-button" id="presentear">üéÅ Presentear</button>
  </div>
</div>

<div class="sub-modal" id="modalDress">
  <div class="sub-modal-content">
    <span class="close" data-close="modalDress">&times;</span>
    <h3>C√≥digo de Vestimenta</h3>
    <ul><li>Esporte fino</li></ul>
  </div>
</div>

<div class="sub-modal" id="modalPresentes">
  <div class="sub-modal-content">
    <span class="close" data-close="modalPresentes">&times;</span>
    <h3>Lista de Presentes</h3>
    <ul>
      <li>Acess√≥rios/Brinco/Colar</li>
      <li>Cart√£o-presente</li>
      <li>Cremes/Creme corporalr</li>
      <li>Perfume</li>
      <li>Produtos para cabelo cacheado</li>
    </ul>
  </div>
</div>

<audio id="bgMusic" src="assets/audio/musica.mp3" loop></audio>

<script>
/* ====== PART√çCULAS ====== */
const particleContainer=document.getElementById('particles');
setInterval(()=>{
  const s=document.createElement('div');
  s.className='spark';
  s.style.left=Math.random()*100+'vw';
  s.style.animationDuration=(3+Math.random()*3)+'s';
  particleContainer.appendChild(s);
  setTimeout(()=>s.remove(),7000);
},300);

/* ====== CARTA + FUMA√áA + GLITTER ====== */
const carta=document.getElementById('carta');
const fumaca=document.getElementById('fumaca');
const convite=document.getElementById('convite');

carta.addEventListener('click', ()=>{
  carta.classList.add('aberta');

  const largura=carta.offsetWidth;

  for(let i=0;i<30;i++){
    setTimeout(()=>{
      const smoke=document.createElement('div');
      smoke.className='smoke';
      smoke.style.setProperty('--x',`${Math.random()*largura/2-largura/4}px`);
      const size=largura*0.1+Math.random()*largura*0.15;
      smoke.style.width=smoke.style.height=size+'px';
      fumaca.appendChild(smoke);
      setTimeout(()=>smoke.remove(),4200);
    },i*100);
  }

  for(let i=0;i<22;i++){
    setTimeout(()=>{
      const g=document.createElement('div');
      g.className='magic-glitter';
      g.style.setProperty('--gx',`${Math.random()*120-60}px`);
      fumaca.appendChild(g);
      setTimeout(()=>g.remove(),2200);
    },i*140);
  }

  setTimeout(()=>{
    convite.style.opacity=1;
    carta.style.display='none';
  },1800);
});

/* ====== M√öSICA ====== */
const music = document.getElementById('bgMusic');
music.volume=0;
const overlay = document.getElementById('audioOverlay');
const savedTime = localStorage.getItem('musicTime');
if(savedTime) music.currentTime=parseFloat(savedTime);

function startMusic(){
  music.play().then(()=>overlay.remove()).catch(()=>{});
  let vol=0;
  const fade=setInterval(()=>{
    if(vol<0.15){ vol+=0.02; music.volume=vol; } 
    else { music.volume=0.13; clearInterval(fade); }
  },120);
}
overlay.addEventListener('click', startMusic, {once:true});
overlay.addEventListener('touchstart', startMusic, {once:true});
window.addEventListener('load', startMusic);
window.addEventListener('beforeunload', ()=>localStorage.setItem('musicTime', music.currentTime));

/* ====== ESTRELAS ====== */
for(let i=0;i<160;i++){
  const star=document.createElement("div");
  star.className="star";
  star.style.left=Math.random()*100+"vw";
  star.style.animationDuration=(3+Math.random()*4)+"s";
  star.style.animationDelay=Math.random()*5+"s";
  document.body.appendChild(star);
}

/* ====== PART√çCULAS REAGINDO √Ä BATIDA ====== */
let audioCtx, analyser, dataArray;
function initAudioAnalysis(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const source=audioCtx.createMediaElementSource(music);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;
  const bufferLength=analyser.frequencyBinCount;
  dataArray=new Uint8Array(bufferLength);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
}
function getBeatIntensity(){
  if(!analyser) return 0;
  analyser.getByteFrequencyData(dataArray);
  let sum=0;
  for(let i=0;i<dataArray.length;i++) sum+=dataArray[i];
  return sum/dataArray.length;
}
const originalPlay=music.play.bind(music);
music.play=()=>{
  if(!audioCtx) initAudioAnalysis();
  if(audioCtx.state==="suspended") audioCtx.resume();
  return originalPlay();
};
setInterval(()=>{
  const intensity=getBeatIntensity();
  if(intensity>55){
    const burst=document.createElement('div');
    burst.className='spark';
    burst.style.left=Math.random()*100+'vw';
    burst.style.width='3px';
    burst.style.height='3px';
    burst.style.boxShadow='0 0 8px #ffd700';
    burst.style.animationDuration='2s';
    burst.style.opacity=0.9;
    particleContainer.appendChild(burst);
    setTimeout(()=>burst.remove(),4000);
  }
},120);

/* ====== MODAIS ====== */
document.querySelector(".btn-modal").onclick=()=>modalPrincipal.style.display="flex";
document.getElementById("dressCode").onclick=()=>modalDress.style.display="flex";
document.getElementById("presentear").onclick=()=>modalPresentes.style.display="flex";
document.getElementById("verRota").onclick=()=>window.open("https://maps.app.goo.gl/9Ujs9UPoccGrVMJb8","_blank");
document.getElementById("confirmePresenca").onclick=()=>window.open("https://wa.me/5551992226662?text=Ol√°,%20confirmo%20minha%20presen√ßa%20no%20seu%20anivers√°rio!","_blank");
document.querySelectorAll(".close").forEach(btn=>btn.onclick=()=>document.getElementById(btn.dataset.close).style.display="none");
window.onclick=e=>document.querySelectorAll(".modal,.sub-modal").forEach(m=>{if(e.target===m)m.style.display="none";});
</script>

</body>
</html>
